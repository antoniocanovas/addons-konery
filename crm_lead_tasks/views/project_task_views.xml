<?xml version='1.0' encoding='UTF-8'?>
<data>

    <!-- Window action o2m to tasks: -->
    <record model="ir.actions.act_window" id="action_crm_lead_tasks">
        <field name="name">CRM Lead tasks</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_lead_id': active_id,'default_lead_id': active_id}</field>
        <field name="domain">[('lead_id', '=',active_id)]</field>
    </record>

    <record id="task_opportunity_inh_form_view" model="ir.ui.view">
        <field name="name">Task opportunity Form View</field>
        <field name="model">project.task</field>
        <field name="type">form</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" icon="fa-tasks" type="action" name="%(action_crm_lead_tasks)d">
                    <field name="task_count" string="Tasks" widget="statinfo"/>
                </button>
            </xpath>
            <field name="date_last_stage_update" position="after">
                <field name="lead_id" groups="sales_team.group_sale_salesman"/>
            </field>
        </field>
    </record>

</data>
